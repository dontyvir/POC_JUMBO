jornadasAnteriores=SELECT ID_JPICKING FROM (SELECT * FROM BO_JORNADAS_PICK WHERE ID_LOCAL = idLocal AND FECHA = (fechaConsultaAnterior) ORDER BY ID_HOR_PICK DESC)Y UNION ALL SELECT ID_JPICKING FROM (SELECT * FROM BO_JORNADAS_PICK WHERE ID_LOCAL = idLocal AND FECHA = (fechaConsultaActual) AND ID_HOR_PICK <= (horarioConsulta) ORDER BY ID_HOR_PICK DESC)X FETCH FIRST 3 ROWS ONLY
jornadasPosteriores=select N.ID_JPICKING, COUNT(ID_PEDIDO) CANT_PEDIDOS FROM BO_PEDIDOS RIGHT OUTER JOIN (SELECT ID_JPICKING FROM(SELECT ID_JPICKING FROM BO_JORNADAS_PICK WHERE ID_HOR_PICK IN (SELECT * FROM (SELECT ID_HOR_PICK FROM BO_HORARIO_PICK WHERE ID_SEMANA IN (SELECT ID_SEMANA FROM BO_SEMANAS WHERE fechaConsultaPosterior BETWEEN FINI AND FFIN) and id_local = idLocal UNION ALL SELECT ID_HOR_PICK FROM BO_HORARIO_PICK WHERE ID_SEMANA IN (SELECT ID_SEMANA FROM BO_SEMANAS WHERE fechaConsultaActual BETWEEN FINI AND FFIN) and id_local = idLocal AND ID_HOR_PICK >= horarioConsulta)Z FETCH FIRST 4 ROWS ONLY) AND ID_LOCAL = idLocal AND FECHA BETWEEN (fechaConsultaActual) AND (fechaConsultaPosterior) ORDER BY FECHA ASC) x where ID_JPICKING NOT IN (SELECT ID_JPICKING FROM BO_JORNADAS_PICK WHERE ID_HOR_PICK IN (SELECT ID_HOR_PICK FROM BO_HORARIO_PICK WHERE ID_SEMANA = ( SELECT ID_SEMANA FROM BO_SEMANAS WHERE (fechaConsultaActual) BETWEEN FINI AND FFIN) AND ID_HOR_PICK <  horarioConsulta AND ID_LOCAL = idLocal) AND ID_LOCAL = idLocal AND FECHA = (fechaConsultaActual)) FETCH FIRST 4 ROWS ONLY ) N ON (BO_PEDIDOS.ID_JPICKING = N.ID_JPICKING) GROUP BY N.ID_JPICKING
prodFaltantesAnteriores=SELECT DISTINCT BO_DETALLE_PEDIDO.ID_PRODUCTO FROM BO_PEDIDOS INNER JOIN BO_DETALLE_PEDIDO ON BO_PEDIDOS.ID_PEDIDO = BO_DETALLE_PEDIDO.ID_PEDIDO WHERE BO_PEDIDOS.ID_JPICKING IN (jornadasAnteriores) AND BO_DETALLE_PEDIDO.CANT_FALTAN > 0 UNION Select ID_PRODUCTO FROM BO_DETALLE_PEDIDO WHERE ID_DETALLE IN (SELECT DISTINCT BO_DETALLE_PICKING.ID_DETALLE FROM BO_PEDIDOS INNER JOIN BO_DETALLE_PICKING ON BO_PEDIDOS.ID_PEDIDO = BO_DETALLE_PICKING.ID_PEDIDO WHERE BO_PEDIDOS.ID_JPICKING IN (jornadasAnteriores) AND BO_DETALLE_PICKING.SUSTITUTO = 'S')
prodJornadasActuales=SELECT PRODUCTOS_ANTERIORES.ID_JPICKING ID_JPICKING, PRODUCTOS_ANTERIORES.ID_PRODUCTO ID_PRODUCTO, PRODUCTOS_ANTERIORES.DESCRIPCION, PRODUCTOS_ANTERIORES.NOMBRE,PRODUCTOS_ANTERIORES.CANT_SOLIC, PRODUCTOS_ANTERIORES.CANT_PROD_EN_OP_X_JORNADA CANT_PROD_EN_OP_X_JORNADA, PRODUCTOS_ANTERIORES.TOTAL_OPS_X_JORNADA TOTAL_OPS_X_JORNADA,ROUND(((DOUBLE(PRODUCTOS_ANTERIORES.CANT_PROD_EN_OP_X_JORNADA) / DOUBLE(PRODUCTOS_ANTERIORES.TOTAL_OPS_X_JORNADA)) * 100),2) PORC_PRESENCIA FROM (SELECT BO_DETALLE_PEDIDO.ID_PRODUCTO ID_PRODUCTO,SUM(BO_DETALLE_PEDIDO.CANT_SOLIC) CANT_SOLIC,BO_DETALLE_PEDIDO.DESCRIPCION,BO_SECTOR.NOMBRE,COUNT(BO_PEDIDOS.ID_PEDIDO) CANT_PROD_EN_OP_X_JORNADA,X.ID_JPICKING,X.OPS_X_JORNADA TOTAL_OPS_X_JORNADA FROM BO_PEDIDOS INNER JOIN BO_DETALLE_PEDIDO ON BO_DETALLE_PEDIDO.ID_PEDIDO = BO_PEDIDOS.ID_PEDIDO INNER JOIN BO_SECTOR ON BO_DETALLE_PEDIDO.ID_SECTOR = BO_SECTOR.ID_SECTOR INNER JOIN (SELECT COUNT(DISTINCT(BO_PEDIDOS.ID_PEDIDO)) OPS_X_JORNADA, BO_PEDIDOS.ID_JPICKING FROM BO_JORNADAS_PICK, BO_PEDIDOS, BO_DETALLE_PEDIDO WHERE BO_PEDIDOS.ID_JPICKING = BO_JORNADAS_PICK.ID_JPICKING AND BO_PEDIDOS.ID_PEDIDO = BO_DETALLE_PEDIDO.ID_PEDIDO AND BO_JORNADAS_PICK.ID_JPICKING IN (jornadasPosteriores) GROUP BY BO_PEDIDOS.ID_JPICKING ORDER BY BO_PEDIDOS.ID_JPICKING) X ON BO_PEDIDOS.ID_JPICKING = X.ID_JPICKING GROUP BY BO_DETALLE_PEDIDO.ID_PRODUCTO, BO_DETALLE_PEDIDO.DESCRIPCION,BO_SECTOR.NOMBRE, X.ID_JPICKING, X.OPS_X_JORNADA) PRODUCTOS_ANTERIORES WHERE PRODUCTOS_ANTERIORES.ID_PRODUCTO IN (productosFaltantesAnteriores)
jornadaConsulta=SELECT id_hor_pick, fecha, ID_LOCAL FROM BO_JORNADAS_PICK WHERE id_jpicking = jornadaActual